(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{174:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return r})),a.d(t,"rightToc",(function(){return c})),a.d(t,"default",(function(){return s}));var n=a(3),o=(a(0),a(186));const i={id:"orm",title:"Object Relational Mapping (ORM)",sidebar_label:"Object Relational Mapping"},r={unversionedId:"readings/db/orm",id:"readings/db/orm",isDocsHomePage:!1,title:"Object Relational Mapping (ORM)",description:"Object-relational mapping (ORM) is an application (library) to map your objects to a relational database; typically, you describe which classes and properties in the code map to which tables and columns in the database, and then the library does all the copying and translating. In this scenario, ORM sits between JDBC and the rest of your Java application.",source:"@site/docs\\readings\\db\\orm.md",slug:"/readings/db/orm",permalink:"/cs421_f20/docs/readings/db/orm",editUrl:"https://darvishdarab.github.io/cs421_f20/docs/readings/db/orm.md",version:"current",sidebar_label:"Object Relational Mapping",sidebar:"docs",previous:{title:"A Reflection on Implementation",permalink:"/cs421_f20/docs/readings/db/code_reflect"},next:{title:"Separation of client and server",permalink:"/cs421_f20/docs/readings/restful/api"}},c=[{value:"Sql2o",id:"sql2o",children:[]},{value:"<code>Sql2oAuthorDao</code>",id:"sql2oauthordao",children:[{value:"<code>Sql2oAuthorDao.add</code>",id:"sql2oauthordaoadd",children:[]},{value:"<code>Sql2oBookDao.listAll</code>",id:"sql2obookdaolistall",children:[]}]}],l={rightToc:c};function s({components:e,...t}){return Object(o.b)("wrapper",Object(n.a)({},l,t,{components:e,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Object-relational mapping (ORM) is an application (library) to map your objects to a relational database; typically, you describe which classes and properties in the code map to which tables and columns in the database, and then the library does all the copying and translating. In this scenario, ORM sits between JDBC and the rest of your Java application."),Object(o.b)("p",null,Object(o.b)("img",{src:a(320).default})),Object(o.b)("h2",{id:"sql2o"},"Sql2o"),Object(o.b)("p",null,Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.sql2o.org/"}),"Sql2o")," is a small java library, with the purpose of making database interaction easy. To use Sql2o, you must add it as a dependency to your project. Open ",Object(o.b)("inlineCode",{parentName:"p"},"gradle.build")," and add the following line to the ",Object(o.b)("inlineCode",{parentName:"p"},"dependencies")," block."),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-groovy"}),"implementation group: 'org.sql2o', name: 'sql2o', version: '1.6.0'\n")),Object(o.b)("h2",{id:"sql2oauthordao"},Object(o.b)("inlineCode",{parentName:"h2"},"Sql2oAuthorDao")),Object(o.b)("p",null,"Let's provide an implementation for ",Object(o.b)("inlineCode",{parentName:"p"},"AuthorDao")," interface that uses ",Object(o.b)("inlineCode",{parentName:"p"},"Sql2o"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),"package persistence;\n\nimport exception.DaoException;\nimport model.Author;\nimport java.util.List;\nimport org.sql2o.*;\n\npublic class Sql2oAuthorDao implements AuthorDao {\n\n    private final Sql2o sql2o;\n\n    public Sql2oAuthorDao(Sql2o sql2o) {\n        this.sql2o = sql2o;\n    }\n\n    @Override\n    public int add(Author author) throws DaoException {\n      // implementation given below    \n    }\n\n    @Override\n    public List<Author> listAll() {\n      // implementation given below\n    }\n\n\n}\n")),Object(o.b)("p",null,"When we use a Sql2o object, a convenient way to open a ",Object(o.b)("inlineCode",{parentName:"p"},"Connection")," is as follows:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),"try(Connection con = sql2o.open()) {\n  // Do something with database.\n} catch (Sql2oException ex) {\n  // Deal with exception.\n}\n")),Object(o.b)("p",null,"In case this is the first time you see a ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html"}),"try-with-resources statement"),", this construct ensures that the resource is closed at the end of the statement.",Object(o.b)("sup",Object(n.a)({parentName:"p"},{id:"fnref-1"}),Object(o.b)("a",Object(n.a)({parentName:"sup"},{href:"#fn-1",className:"footnote-ref"}),"1"))),Object(o.b)("h3",{id:"sql2oauthordaoadd"},Object(o.b)("inlineCode",{parentName:"h3"},"Sql2oAuthorDao.add")),Object(o.b)("p",null,"The power of Sql2o is in ",Object(o.b)("strong",{parentName:"p"},"binding")," to an object; let's see that in action:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),'@Override\npublic int add(Author author) throws DaoException {\n    try (Connection con = sql2o.open()) {\n        String query = "INSERT INTO Authors (name, numOfBooks, nationality)" +\n                       "VALUES (:name, :numOfBooks, :nationality)";\n        int id = (int) con.createQuery(query, true)\n                .bind(author)\n                .executeUpdate().getKey();\n        author.setId(id);\n        return id;\n    }\n}\n')),Object(o.b)("p",null,"Note that we return the generated ",Object(o.b)("inlineCode",{parentName:"p"},"id")," integer value by the database from the ",Object(o.b)("inlineCode",{parentName:"p"},"add")," method for confirmation."),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"For ",Object(o.b)("em",{parentName:"p"},"binding")," to work seamlessly you need to have the same name for fields in the object and column names in your table.",Object(o.b)("sup",Object(n.a)({parentName:"p"},{id:"fnref-2"}),Object(o.b)("a",Object(n.a)({parentName:"sup"},{href:"#fn-2",className:"footnote-ref"}),"2"))))),Object(o.b)("h3",{id:"sql2obookdaolistall"},Object(o.b)("inlineCode",{parentName:"h3"},"Sql2oBookDao.listAll")),Object(o.b)("p",null,"With Sql2o, when fetching data from the database, the ",Object(o.b)("inlineCode",{parentName:"p"},"ResultSet")," will automatically be filled into your POJO objects."),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),'@Override\npublic List<Author> listAll() {\n  String sql = "SELECT * FROM Authors";\n  try (Connection con = sql2o.open()) {\n    return con.createQuery(sql).executeAndFetch(Author.class);\n  }\n}\n')),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Similarly, you can define a ",Object(o.b)("inlineCode",{parentName:"p"},"Sql2oBookDao")," class."))),Object(o.b)("div",{className:"admonition admonition-danger alert alert--danger"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})))),"Important note on the foreign key constraint")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"When implementing ",Object(o.b)("inlineCode",{parentName:"p"},"BookDao.Add")," to insert a new record into the ",Object(o.b)("inlineCode",{parentName:"p"},"Books")," table using ",Object(o.b)("inlineCode",{parentName:"p"},"Sql2oBookDao.add"),", you need a valid ",Object(o.b)("inlineCode",{parentName:"p"},"authorId"),", since there is a foreign key constraint on that attribute. This means any value you use there must already exist in ",Object(o.b)("inlineCode",{parentName:"p"},"Authors")," table; an ",Object(o.b)("inlineCode",{parentName:"p"},"author")," with that particular ",Object(o.b)("inlineCode",{parentName:"p"},"id")," value must be present in the ",Object(o.b)("inlineCode",{parentName:"p"},"Authors")," table before trying to add the book.",Object(o.b)("sup",Object(n.a)({parentName:"p"},{id:"fnref-3"}),Object(o.b)("a",Object(n.a)({parentName:"sup"},{href:"#fn-3",className:"footnote-ref"}),"3"))))),Object(o.b)("div",{className:"footnotes"},Object(o.b)("hr",{parentName:"div"}),Object(o.b)("ol",{parentName:"div"},Object(o.b)("li",Object(n.a)({parentName:"ol"},{id:"fn-1"}),"A resource is an object that must be ",Object(o.b)("strong",{parentName:"li"},"closed")," after the program is finished with it. ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"#fnref-1",className:"footnote-backref"}),"\u21a9")),Object(o.b)("li",Object(n.a)({parentName:"ol"},{id:"fn-2"}),"If fields' name are not the same as column names, you may use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/aaberg/sql2o/wiki/Column-mappings"}),"column mapping")," feature of Sql2o.",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"#fnref-2",className:"footnote-backref"}),"\u21a9")),Object(o.b)("li",Object(n.a)({parentName:"ol"},{id:"fn-3"}),"We will revisit this issue in more details when we get into implementing ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"docs/readings/bookapp"}),"MyBooksApp")," as a wb application. For now, make sure when adding a new book, ",Object(o.b)("inlineCode",{parentName:"li"},"authorId")," is valid.",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"#fnref-3",className:"footnote-backref"}),"\u21a9")))))}s.isMDXComponent=!0},186:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return u}));var n=a(0),o=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=o.a.createContext({}),b=function(e){var t=o.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},p=function(e){var t=b(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,r=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=b(a),m=n,u=p["".concat(r,".").concat(m)]||p[m]||d[m]||i;return a?o.a.createElement(u,c(c({ref:t},s),{},{components:a})):o.a.createElement(u,c({ref:t},s))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,r=new Array(i);r[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:n,r[1]=c;for(var s=2;s<i;s++)r[s]=a[s];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"},320:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/orm-805241df4b0cc0db31f8cd5595f69e75.png"}}]);